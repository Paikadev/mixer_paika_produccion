<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Voxeet SDK and jQuery the CDN unpkg.com -->
    <script type="text/javascript" src="https://unpkg.com/@voxeet/voxeet-web-sdk@3.4"></script>
    <script type="text/javascript" src="https://unpkg.com/jquery"></script>

    <!-- Mixer layout script and styles -->
    <script type="text/javascript" src="events.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <div class="hide">
        <input type="hidden" value="accessToken" id="accessToken" name="accessToken" />
        <input type="hidden" value="refreshToken" id="refreshToken" name="refreshToken" />
        <input type="hidden" value="refreshUrl" id="refreshUrl" name="refreshUrl" />
        <input type="hidden" value="catToken" id="catToken" name="catToken" />
        <input type="hidden" value="voxeet" id="conferenceId" name="conferenceId" />
        <input type="hidden" value="1234" id="thirdPartyId" name="thirdPartyId" />
        <input type="hidden" value="stream" id="layoutType" name="layoutType" />
        <button id="joinConference">Join conference</button>
        <button id="replayConference">Replay conference</button>
    </div>







    
    <div id="redDivContainer">
        <div class="redDiv" id="imgPrompt">
        </div>
        <div class="redDiv videos-container" id="videos-container">

        </div>
        <div class="redDiv" id="divInfo" id="imgPrompt">
            <div id="textPrompt">
            </div>
            <div id="timerPrompt">

            </div>
            <div id="divTypePrompt">

            </div>
        </div>
    </div>
    <div id="blueDiv">
        <div id="columnaPlayers"></div>
    </div>
    <div id="greenDiv"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>

        var apiKey = 'wyOVDRkAyXfNDepFmXyN8u9vzaB5lfJk';
        //var giphyUrl = 'https://api.giphy.com/v1/gifs/random?api_key=' + apiKey;



        var socket = io.connect('https://equatorial-jungle-koi.glitch.me/');

        var lobbyShow = true;
        var type = "";
        const id_interaction = ""
        //const conference_Id = $("#conferenceId").val();

        const conference_Id = "5e43cbeb-72d8-49d4-909b-abd18d2a4691"

        const columnaPlayers = document.getElementById("columnaPlayers");


        socket.on('connect', function () {
            console.log('conectado!')

            const texto = document.createTextNode("Conectado a socket ");
            columnaPlayers.appendChild(texto);

            const texto2 = document.createTextNode("id conf" + conference_Id);
            columnaPlayers.appendChild(texto);
           

            socket.emit('get_interaction_id', conference_Id);
            console.log("Get id interaction with conference id " + conference_Id)
            
            document.getElementById('greenDiv').style.display = 'none';
            document.getElementById('blueDiv').style.display = 'block';
           // document.querySelectorAll('.redDiv').forEach(div => {
            //    div.style.display = 'none';
            //});
        })
        socket.on('text', function (response) {
            if (response['text'] != "...") {
                document.getElementById('textPrompt').innerHTML = response['text'];

            }
        });

        socket.on('set_interaction_id', function (response) {
            var json = JSON.stringify(response);
            const data = JSON.parse(json);
            console.log("Set interaction " + data)

             
            const texto3 = document.createTextNode("id Interaction" + data.result);
            columnaPlayers.appendChild(texto3);
            //id_interaction = data.result[0].idInteraction;
            
            //socket.emit('join',data.result[0].idInteraction);
            socket.emit('join','252');
            
            const texto4 = document.createTextNode(" Se unio - ");
            columnaPlayers.appendChild(texto4);
        });

        socket.on('img', function (response) {
            console.log("urlImagen: " + response['img'])
            document.getElementById('imgPrompt').innerHTML = '';
            if (response['img'] != 'null') {

                document.getElementById('imgPrompt').innerHTML = '<img id="imagePromptSrc" src="' + response['img'] + '"> ';
            }
        });
        socket.on('type', function (response) {
            console.log(response['type'])
            if (response['type'] === "Votes") {
                document.getElementById('divTypePrompt').innerHTML = '<div class="progress-bar"><div class="progress-bar__fill"></div><div class="progress-bar__text">50%</div></div>';
                console.log("Entro chatVotes")
            }
            if (response['type'] === "MultipleOptions") {
                console.log("Entr√≥ multiple options")
                //document.getElementById('divTypePrompt').innerHTML = '<div id="columnaOptions">';
            }
        });

        socket.on('timer', function (response) {
            document.getElementById('timerPrompt').innerHTML = response['timer'];
            if (response['timer'] === 1) {
                document.getElementById('divTypePrompt').innerHTML = '';
            }
        });

        socket.on('option_1', function (response) {
            console.log(response['option_1'])
            var divElement = document.getElementById('divTypePrompt');
            var contenidoActual = divElement.innerHTML;
            var nuevoContenido = contenidoActual + '<div id="columnaOptions">' + response['option_1'] + '</div>';
            divElement.innerHTML = nuevoContenido;
        });
        socket.on('option_2', function (response) {
            var divElement = document.getElementById('divTypePrompt');
            var contenidoActual = divElement.innerHTML;
            var nuevoContenido = contenidoActual + '<div id="columnaOptions">' + response['option_2'] + '</div>';
            divElement.innerHTML = nuevoContenido;
        });
        socket.on('option_3', function (response) {
            var divElement = document.getElementById('divTypePrompt');
            var contenidoActual = divElement.innerHTML;
            var nuevoContenido = contenidoActual + '<div id="columnaOptions">' + response['option_3'] + '</div>';
            divElement.innerHTML = nuevoContenido;
        });

        socket.on('option_4', function (response) {
            var divElement = document.getElementById('divTypePrompt');
            var contenidoActual = divElement.innerHTML;
            var nuevoContenido = contenidoActual + '<div id="columnaOptions">' + response['option_4'] + '</div>';
            divElement.innerHTML = nuevoContenido;
        });

        socket.on('start', function (response) {
            const texto = document.createTextNode(" Start - ");
            columnaPlayers.appendChild(texto);
            console.log("Start param" + response['start'])
            if (lobbyShow === true) {
                if (response['start'] === 0) {
                    document.getElementById('blueDiv').style.display = 'block';
                    document.querySelectorAll('.redDiv').forEach(div => {
                        div.style.display = 'none';
                    });
                } else if (response['start'] === 1) {
                    document.getElementById('blueDiv').style.display = 'none';
                    document.querySelectorAll('.redDiv').forEach(div => {
                        div.style.display = 'block';
                    });
                }

                lobbyShow = false
            }
        });


       
       // initializeVoxeetSDK();
    </script>
</body>

</html>





  // Add the video stream to the web page
        const addVideoNode = (participant, stream) => {
            let participantNode = $("#participant-" + participant.id);

            if (!participantNode.length) {
                participantNode = $("<div />")
                    .attr("id", "participant-" + participant.id)
                    .addClass("container")
                    .appendTo("#videos-container");

                $("<video autoplay playsInline muted />")
                    .appendTo(participantNode);


            }

            // Attach the stream to the video element
            navigator.attachMediaStream(participantNode.find("video").get(0), stream);
        };